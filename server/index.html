<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crash Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #game-container {
            margin-top: 20px;
        }
        #messages {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
            height: 200px;
            overflow-y: scroll;
        }
    </style>
</head>
<body>
    <h1>Crash Game</h1>
    <div>
        <label for="bet">Bet Amount:</label>
        <input type="number" id="bet" min="1" step="1">
        <button id="start-game">Start Game</button>
    </div>
    <div id="game-container">
        <button id="claim" disabled>Claim</button>
        <div id="messages"></div>
    </div>

    <script>
        let websocket;
        const betInput = document.getElementById('bet');
        const startGameButton = document.getElementById('start-game');
        const claimButton = document.getElementById('claim');
        const messagesDiv = document.getElementById('messages');

        function appendMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.textContent = message;
            messagesDiv.appendChild(messageElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        startGameButton.addEventListener('click', () => {
            const bet = betInput.value;
            if (!bet) {
                alert('Please enter a bet amount.');
                return;
            }

            websocket = new WebSocket('ws://localhost:8000/api/crash/ws');
            websocket.onopen = () => {
                appendMessage('WebSocket connection opened.');
                websocket.send(JSON.stringify({
                    bet: parseInt(bet, 10),
                    secret: Math.random().toString(36)
                }));
            };

            websocket.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.type === 'countdown') {
                    appendMessage(`Countdown: ${data.value}`);
                } else if (data.type === 'crash') {
                    appendMessage(`Crash Value: ${data.value}`);
                    claimButton.disabled = false;
                } else if (data.status === 'ok') {
                    appendMessage(`Claimed: ${data.value}`);
                    claimButton.disabled = true;
                }
            };

            websocket.onclose = () => {
                appendMessage('WebSocket connection closed.');
            };

            websocket.onerror = (error) => {
                appendMessage(`WebSocket error: ${error.message}`);
            };
        });

        claimButton.addEventListener('click', () => {
            if (websocket && websocket.readyState === WebSocket.OPEN) {
                websocket.send(JSON.stringify({ action: 'claim' }));
            }
        });
    </script>
</body>
</html>